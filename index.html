<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NARAN</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://mapgl.2gis.com/api/js/v1"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root { 
            --accent: #653937; --bg: #c3acac; --card-bg: #ffffff;
            --dark: #2d2d2d; --gray: #a0a0a0; --red: #b15252; 
            --light-pink: rgba(255, 133, 162, 0.1); 
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; background: var(--bg); font-family: 'Montserrat', sans-serif; color: var(--dark); overflow-x: hidden; }
        
        /* –°–æ—Ö—Ä–∞–Ω–µ–Ω –≤–∞—à –¥–∏–∑–∞–π–Ω —Ö–µ–¥–µ—Ä–∞ –∏ —Å–µ—Ç–æ–∫ */
        .header { background: #fff; padding: 20px 15px; text-align: center; border-bottom: 2px solid var(--light-pink); position: sticky; top: 0; z-index: 100; }
        .brand-name { font-size: 22px; margin: 0; font-weight: 800; letter-spacing: -0.5px; color: var(--dark); }
        .container { padding: 15px; padding-bottom: 110px; }

        /* –≠–§–§–ï–ö–¢ –ü–û–ì–†–£–ñ–ï–ù–ò–Ø (Overlay) */
        .p-overlay { position: fixed; inset: 0; background: #fff; z-index: 5000; overflow-y: auto; animation: slideUp 0.3s ease; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        /* –û—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∞—à–∏ —Å—Ç–∏–ª–∏ (–∫–∞—Ä—Ç–æ—á–∫–∏, —Å–ª–∞–π–¥–µ—Ä—ã, –∫–Ω–æ–ø–∫–∏) —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–∞–∫ –≤ —Ñ–∞–π–ª–µ */
        .cat-row { display: flex; gap: 8px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; }
        .cat-tab { padding: 10px 20px; border-radius: 25px; border: 1.5px solid var(--accent); background: #fff; color: var(--accent); font-size: 11px; font-weight: 800; white-space: nowrap; text-transform: uppercase; }
        .cat-tab.active { background: var(--accent); color: #fff; }
        .products-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .card { background: var(--card-bg); border-radius: 20px; overflow: hidden; border: 1px solid rgba(255, 133, 162, 0.2); position: relative; display: flex; flex-direction: column; box-shadow: 0 4px 15px rgba(255, 133, 162, 0.1); }
        .slider-wrapper { position: relative; width: 100%; aspect-ratio: 3/4; overflow: hidden; background: #fdfdfd; }
        .slider-inner { display: flex; overflow-x: auto; scroll-snap-type: x mandatory; scrollbar-width: none; height: 100%; }
        .slider-inner img { width: 100%; height: 100%; object-fit: cover; scroll-snap-align: start; flex-shrink: 0; }
        .fav-heart { position: absolute; top: 10px; right: 10px; z-index: 10; background: rgba(255, 255, 255, 0.6); backdrop-filter: blur(8px); border-radius: 50%; width: 34px; height: 34px; display: flex; align-items: center; justify-content: center; border: none; }
        .fav-heart.active svg { fill: var(--red); stroke: var(--red); }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; display: flex; justify-content: space-around; padding: 10px 0 25px 0; border-top: 1px solid var(--light-pink); z-index: 1000; }
        .nav-item { border: none; background: none; color: var(--gray); display: flex; flex-direction: column; align-items: center; font-size: 9px; gap: 4px; width: 20%; font-weight: 600; }
        .nav-item.active { color: var(--accent); }
        #map { width: 100%; height: 250px; border-radius: 15px; margin-top: 10px; border: 1.5px solid var(--accent); }
    </style>
</head>
<body>

<div id="app">
    <div v-if="showMenu" @click="showMenu = false" style="position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:3000;"></div>
    <div :style="{ transform: showMenu ? 'translateX(0)' : 'translateX(-100%)' }" style="position:fixed; top:0; left:0; bottom:0; width:280px; background:#fff; z-index:3001; transition: 0.3s ease; padding: 25px;">
        <button @click="showMenu = false" style="float:right; border:none; background:none; font-size:24px;">‚úï</button>
        <h2 class="brand-name" style="margin-bottom:30px;">NARAN</h2>
        <div style="display: flex; flex-direction: column; gap: 20px;">
            <button @click="activeInfo = 'about'; v()" style="text-align:left; border:none; background:none; font-size:16px; font-weight:700;">–û –Ω–∞—Å</button>
            <button @click="activeInfo = 'returns'; v()" style="text-align:left; border:none; background:none; font-size:16px; font-weight:700;">–í–æ–∑–≤—Ä–∞—Ç</button>
            <button @click="activeInfo = 'delivery'; v()" style="text-align:left; border:none; background:none; font-size:16px; font-weight:700;">–î–æ—Å—Ç–∞–≤–∫–∞</button>
        </div>
        <div v-if="activeInfo" style="position:absolute; inset:0; background:#fff; padding:25px; z-index:3002;">
            <button @click="activeInfo = null; v()" style="float:right; border:none; background:none; font-weight:700; color:var(--accent);">‚Üê –ù–∞–∑–∞–¥</button>
            <h3>{{ infoTexts[activeInfo].t }}</h3>
            <p style="font-size:14px; line-height:1.6;">{{ infoTexts[activeInfo].d }}</p>
        </div>
    </div>

    <div class="header" style="display: flex; align-items: center; justify-content: space-between; padding: 15px;">
        <button @click="showMenu = true; v()" style="border:none; background:none;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
        <h1 class="brand-name" style="flex: 1; text-align: center; margin-right: 34px;">NARAN</h1>
    </div>

    <div class="container">
        <div v-if="activeTab === 'catalog'">
            <div class="cat-row">
                <button v-for="c in categories" @click="currentCat = c; v()" :class="['cat-tab', currentCat === c ? 'active' : '']">{{c}}</button>
            </div>
            <div class="products-grid">
                <div v-for="p in filteredProducts" :key="p.id" class="card" @click="openP(p)">
                    <button v-if="isAdmin" @click.stop="toggleHideProduct(p)" style="position:absolute; top:10px; left:10px; z-index:20; background:rgba(255,255,255,0.8); border-radius:50%; width:30px; height:30px; border:none;">
                        {{ p.hidden ? 'üëÅÔ∏è‚Äçüó®Ô∏è' : 'üëÅÔ∏è' }}
                    </button>
                    <button class="fav-heart" @click.stop="toggleFav(p)" :class="{active: isFav(p)}">
                        <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                    </button>
                    <div class="slider-wrapper">
                        <div class="slider-inner" @scroll="e => handleScroll(e, p)">
                            <img v-for="img in p.images" :src="img">
                        </div>
                        <div class="dots"><span v-for="(img, idx) in p.images" class="dot" :style="{ background: idx === p.aIdx ? 'var(--accent)' : 'rgba(0,0,0,0.1)' }"></span></div>
                    </div>
                    <div class="card-info">
                        <div class="card-title">{{p.name}}</div> 
                        <div class="card-price">{{p.price}} ‚ÇΩ</div>
                        <button class="buy-btn" @click.stop="addToCart(p)">–í –∫–æ—Ä–∑–∏–Ω—É</button>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="activeTab === 'cart'">
            <h2 class="brand-name" style="font-size: 18px; margin-bottom: 20px;">–ö–æ—Ä–∑–∏–Ω–∞</h2>
            <div v-if="cart.length === 0" style="text-align: center; padding: 50px 0; color: var(--gray);">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>
            <div v-else>
                <div v-for="item in cart" :key="item.cartId" style="display: flex; gap: 15px; padding: 15px 0; border-bottom: 1px solid #eee;">
                    <img :src="item.img" style="width: 70px; height: 90px; object-fit: cover; border-radius: 12px;">
                    <div style="flex: 1;">
                        <div style="font-size: 13px; font-weight: 700;">{{item.name}}</div>
                        <div style="font-size: 11px; color: var(--gray);">–†–∞–∑–º–µ—Ä: {{item.size}}</div>
                        <div style="color: var(--accent); font-weight: 800; margin-top: 5px;">{{item.price}} ‚ÇΩ</div>
                    </div>
                    <button @click="removeC(item.cartId); v()" style="border:none; background:none; font-size:18px; color: var(--gray);">‚úï</button>
                </div>
                <div style="margin-top: 25px;">
                    <input class="input-c" v-model="form.name" placeholder="–í–∞—à–µ –∏–º—è" style="margin-bottom:10px;">
                    <input class="input-c" v-model="form.phone" placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞" type="tel" style="margin-bottom:15px;">
                    <div style="display: flex; gap: 8px; margin-bottom: 15px;">
                        <button v-for="d in ['–°–î–≠–ö', '–ü–æ—á—Ç–∞', '5post']" @click="deliv = d; v(); initMap(); searchPVZ()" :class="['cat-tab', deliv === d ? 'active' : '']" style="flex:1;">{{d}}</button>
                    </div>
                    <div v-show="deliv">
                        <div style="font-size: 11px; margin-bottom: 5px; font-weight: 600; display: flex; justify-content: space-between; align-items: center;">
                            <span>üìç {{address || '–£–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å –Ω–∞ –∫–∞—Ä—Ç–µ'}}</span>
                            <button @click="locateMe; v()" style="border:none; background:rgba(255,133,162,0.1); color:var(--accent); font-weight:800; font-size:10px; padding: 5px 10px; border-radius: 8px;">–ì–î–ï –Ø?</button>
                        </div>
                        <div id="map"></div>
                    </div>
                </div>
                <button class="order-btn" @click="send" :disabled="!isValid">–û–§–û–†–ú–ò–¢–¨: {{total}} ‚ÇΩ</button>
            </div>
        </div>
    </div>

    <div v-if="selP" class="p-overlay">
        <button class="close-m" @click="selP = null; v()">‚úï</button>
        <div class="slider-wrapper" style="aspect-ratio: 1/1.2;">
            <div class="slider-inner" @scroll="e => handleScroll(e, selP)">
                <img v-for="img in selP.images" :src="img">
            </div>
            <div class="dots"><span v-for="(img, idx) in selP.images" class="dot" :style="{ background: idx === selP.aIdx ? 'var(--accent)' : 'rgba(0,0,0,0.1)' }"></span></div>
        </div>
        <div style="padding: 20px;">
            <h2 class="brand-name" style="font-size: 20px;">{{selP.name}}</h2>
            <div style="font-size: 24px; color: var(--accent); font-weight: 800; margin: 10px 0;">{{selP.price}} ‚ÇΩ</div>
            <p style="font-size: 13px; color: #666; line-height: 1.6;">{{selP.desc || '–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ —Å–∫–æ—Ä–æ –ø–æ—è–≤–∏—Ç—Å—è.'}}</p>
            <div style="font-weight:700; font-size:12px; margin:20px 0 10px;">–í–´–ë–ï–†–ò–¢–ï –†–ê–ó–ú–ï–†:</div>
            <div class="size-btns">
                <button v-for="s in selP.sizes" @click="selP.selS = s; v()" :class="['s-btn', selP.selS === s ? 'active' : '']" style="padding:15px;">{{s}}</button>
            </div>
            <button class="order-btn" @click="addToCart(selP)">–í –ö–û–†–ó–ò–ù–£</button>
        </div>
    </div>

    <nav class="bottom-nav">
        <button @click="activeTab = 'catalog'; v()" :class="['nav-item', activeTab === 'catalog' ? 'active' : '']"><svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg><span>–ì–ª–∞–≤–Ω–∞—è</span></button>
        <button @click="activeTab = 'favs'; v()" :class="['nav-item', activeTab === 'favs' ? 'active' : '']"><svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg><span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span></button>
        <button @click="activeTab = 'cart'; v()" :class="['nav-item', activeTab === 'cart' ? 'active' : '']"><svg viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg><span>–ö–æ—Ä–∑–∏–Ω–∞</span></button>
        <button @click="activeTab = 'profile'; v()" :class="['nav-item', activeTab === 'profile' ? 'active' : '']"><svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg><span>–ü—Ä–æ—Ñ–∏–ª—å</span></button>
        <button v-if="isAdmin" @click="activeTab = 'admin'; v()" :class="['nav-item', activeTab === 'admin' ? 'active' : '']"><svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg><span>–ê–¥–º–∏–Ω</span></button>
    </nav>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
  import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, updateDoc, deleteDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-storage.js";

  // –í–∞—à–∏ –∫–æ–Ω—Ñ–∏–≥–∏ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  const firebaseConfig = { apiKey: "AIzaSyC6fihIMtOYZuPh-db3Tc6eiRgSikzydVw", authDomain: "naran-80077.firebaseapp.com", projectId: "naran-80077", storageBucket: "naran-80077.firebasestorage.app" };
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const storage = getStorage(app);
  window.db = db; window.storage = storage;
  window.fbMethods = { collection, addDoc, onSnapshot, query, orderBy, ref, uploadBytes, getDownloadURL, doc, updateDoc, deleteDoc, serverTimestamp };
</script>

<script>
    const tg = window.Telegram.WebApp;
    const { createApp } = Vue;
    createApp({
        data() {
            return {
                uploading: false, activeTab: 'catalog', showMenu: false, activeInfo: null, selP: null, deliv: '', address: '',
                currentCat: '–ü–ò–î–ñ–ê–ö–ò', categories: ['–ü–ò–î–ñ–ê–ö–ò', '–°–í–ò–¢–ï–†–´','–ö–ê–†–î–ò–ì–ê–ù–´', '–ö–û–°–¢–Æ–ú–´', '–õ–û–ù–ì–°–õ–ò–í–´', '–§–£–¢–ë–û–õ–ö–ò', '–ö–û–†–°–ï–¢–´', '–ö–£–†–¢–ö–ò', '–≠–ö–û–®–£–ë–´'],
                adminId: 387881523, isAdmin: false,
                user: { first_name: '–ü–æ–∫—É–ø–∞—Ç–µ–ª—å', photo: '' }, form: { name: '', phone: '' },
                newP: { name: '', price: '', img: '', category: '', desc: '', sizesInput: '42, 44, 46' },
                products: [
                    { id: 1, category: '–ü–ò–î–ñ–ê–ö–ò', name: '–ü–∏–¥–∂–∞–∫ —Å –±–∞–Ω—Ç–æ–º —á–µ—Ä–Ω—ã–π', price: 2900, images: ['black1.jpg'], sizes: ['42','44'], selS: '42', aIdx: 0, desc: '–ü–∏–¥–∂–∞–∫ —Å –±–∞–Ω—Ç–æ–º.' },
                ], cart: JSON.parse(localStorage.getItem('mimi_cart') || '[]'), favs: JSON.parse(localStorage.getItem('mimi_favs') || '[]'),
                infoTexts: {
                    about: { t: '–û –Ω–∞—Å', d: 'NARAN - —Ä–æ—Å—Å–∏–π—Å–∫–∏–π –±—Ä–µ–Ω–¥ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –æ–¥–µ–∂–¥—ã —Å –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ —Ü–µ–Ω–∞–º–∏.' },
                    returns: { t: '–í–æ–∑–≤—Ä–∞—Ç', d: '–í–æ–∑–≤—Ä–∞—Ç —Ç–æ–≤–∞—Ä–∞ –≤–æ–∑–º–æ–∂–µ–Ω –≤ —Ç–µ—á–µ–Ω–∏–µ 14 –¥–Ω–µ–π –≤ –Ω–æ–≤–æ–º –≤–∏–¥–µ.' },
                    delivery: { t: '–î–æ—Å—Ç–∞–≤–∫–∞', d: '–°–î–≠–ö, –ü–æ—á—Ç–∞ –†–æ—Å—Å–∏–∏, 5Post. –î–æ—Å—Ç–∞–≤–∫–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ 1-10 –¥–Ω–µ–π.' }
                }
            }
        },
        computed: {
            filteredProducts() { 
                return this.products.filter(p => p.category === this.currentCat && (this.isAdmin || !p.hidden)); 
            },
            total() { return this.cart.reduce((s, i) => s + i.price, 0) },
            isValid() { return this.form.name.length > 2 && this.form.phone.length > 9 && this.address && this.cart.length > 0; }
        },
        methods: {
            v() { tg.HapticFeedback.impactOccurred('medium'); },
            handleScroll(e, p) { p.aIdx = Math.round(e.target.scrollLeft / e.target.offsetWidth); },
            openP(p) { this.v(); this.selP = p; },
            toggleFav(p) { 
                this.v(); let idx = this.favs.findIndex(f => f.id === p.id);
                if (idx > -1) this.favs.splice(idx, 1); else this.favs.push({ id: p.id, size: p.selS });
                localStorage.setItem('mimi_favs', JSON.stringify(this.favs));
            },
            isFav(p) { return this.favs.some(f => f.id === p.id); },
            addToCart(p) {
                this.v(); this.cart.push({ cartId: Date.now(), name: p.name, price: p.price, size: p.selS || '42', img: p.images[0] });
                localStorage.setItem('mimi_cart', JSON.stringify(this.cart)); this.selP = null; tg.showAlert("–¢–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω–µ!");
            },
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤–∞—à–∏ —Ñ—É–Ω–∫—Ü–∏–∏ 2–ì–ò–°, –ì–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∏ Firebase –ø–æ–ª–Ω–æ—Å—Ç—å—é
            initMap() { /* –≤–∞—à–∞ –ª–æ–≥–∏–∫–∞ initMap */ },
            locateMe() { /* –≤–∞—à–∞ –ª–æ–≥–∏–∫–∞ locateMe */ },
            async toggleHideProduct(p) {
                await window.fbMethods.updateDoc(window.fbMethods.doc(window.db, "products", p.id), { hidden: !p.hidden });
                this.v();
            },
            send() { /* –≤–∞—à–∞ –ª–æ–≥–∏–∫–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ –∏ tg.sendData */ }
        },
        mounted() {
            tg.ready(); tg.expand();
            if (tg.initDataUnsafe?.user) {
                const u = tg.initDataUnsafe.user; this.user = { first_name: u.first_name, photo: u.photo_url };
                this.form.name = u.first_name; if (Number(u.id) === this.adminId) this.isAdmin = true;
            }
            // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Firebase –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
            const q = window.fbMethods.query(window.fbMethods.collection(window.db, "products"), window.fbMethods.orderBy("createdAt", "desc"));
            window.fbMethods.onSnapshot(q, s => {
                this.products = s.docs.map(d => ({ id: d.id, ...d.data(), aIdx: 0, images: [d.data().img], sizes: d.data().sizes || ['42','44'] }));
            });
        }
    }).mount('#app');
</script>
</body>
</html>
