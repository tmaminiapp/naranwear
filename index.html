<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NARAN PREMIUM | SHOP</title>
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://mapgl.2gis.com/api/js/v1"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg: #ffffff;
            --dark: #000000;
            --gray: #8e8e93;
            --accent: #000000;
            --light: #f4f4f4;
            --border: #eeeeee;
        }

        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            outline: none; 
            user-select: none;
        }

        body { 
            margin: 0; 
            background: var(--bg); 
            font-family: 'Montserrat', sans-serif; 
            color: var(--dark); 
            overflow-x: hidden; 
            -webkit-font-smoothing: antialiased;
        }

        /* Header */
        .header { 
            background: rgba(255,255,255,0.95); 
            padding: 15px 20px; 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            position: sticky; 
            top: 0; 
            z-index: 1000; 
            border-bottom: 1px solid var(--border);
            backdrop-filter: blur(10px);
        }
        .brand-name { 
            font-size: 20px; 
            font-weight: 800; 
            letter-spacing: 4px; 
            text-transform: uppercase; 
            margin: 0;
        }

        .container { 
            padding: 15px; 
            padding-bottom: 120px; 
            min-height: 100vh; 
        }

        /* –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ */
        .cat-row { 
            display: flex; 
            gap: 10px; 
            margin: 5px 0 25px 0; 
            overflow-x: auto; 
            padding: 5px 0; 
            scrollbar-width: none; 
        }
        .cat-row::-webkit-scrollbar { display: none; }
        .cat-tab { 
            padding: 12px 22px; 
            border: 1px solid var(--dark); 
            background: transparent; 
            color: var(--dark); 
            font-size: 10px; 
            font-weight: 700; 
            white-space: nowrap; 
            text-transform: uppercase; 
            border-radius: 2px; 
            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            letter-spacing: 1px;
        }
        .cat-tab.active { 
            background: var(--dark); 
            color: #fff; 
        }

        /* –°–µ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ */
        .products-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 15px; 
        }
        .card { 
            background: #fff; 
            position: relative; 
            overflow: hidden; 
            transition: transform 0.2s ease;
        }
        
        /* –°–ª–∞–π–¥–µ—Ä –≤ –∫–∞—Ä—Ç–æ—á–∫–µ */
        .slider-wrapper { 
            position: relative; 
            width: 100%; 
            aspect-ratio: 3/4; 
            overflow: hidden; 
            background: var(--light); 
        }
        .slider-inner { 
            display: flex; 
            overflow-x: auto; 
            scroll-snap-type: x mandatory; 
            scrollbar-width: none; 
            height: 100%; 
        }
        .slider-inner::-webkit-scrollbar { display: none; }
        .slider-inner img { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
            scroll-snap-align: start; 
            flex-shrink: 0; 
        }
        
        .dots { 
            position: absolute; 
            bottom: 10px; 
            width: 100%; 
            display: flex; 
            justify-content: center; 
            gap: 5px; 
            pointer-events: none; 
        }
        .dot { 
            width: 5px; 
            height: 5px; 
            border-radius: 50%; 
            background: rgba(0,0,0,0.15); 
            transition: 0.3s;
        }
        .dot.active { 
            background: var(--dark); 
            width: 12px; 
            border-radius: 3px; 
        }

        .card-info { padding: 12px 5px; }
        .card-title { 
            font-size: 11px; 
            font-weight: 600; 
            margin-bottom: 6px; 
            text-transform: uppercase; 
            letter-spacing: 0.5px;
            height: 28px;
            overflow: hidden;
            line-height: 1.3;
        }
        .price { 
            font-weight: 800; 
            font-size: 14px; 
            color: var(--dark);
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn-black { 
            background: var(--dark); 
            color: #fff; 
            border: none; 
            padding: 16px; 
            font-weight: 700; 
            font-size: 12px; 
            text-transform: uppercase; 
            width: 100%; 
            cursor: pointer; 
            border-radius: 0; 
            transition: 0.3s;
            letter-spacing: 2px;
        }
        .btn-black:active { opacity: 0.8; transform: scale(0.98); }
        .btn-black:disabled { background: #ccc; pointer-events: none; }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal { 
            position: fixed; 
            inset: 0; 
            background: #fff; 
            z-index: 2000; 
            overflow-y: auto; 
            padding-bottom: 100px;
        }
        .close-modal { 
            position: fixed; 
            top: 15px; 
            right: 15px; 
            z-index: 2100; 
            background: #fff; 
            border: 1px solid #000; 
            width: 40px; 
            height: 40px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-weight: 800; 
            border-radius: 50%;
        }
        
        .size-grid { 
            display: flex; 
            gap: 10px; 
            margin: 20px 0; 
            flex-wrap: wrap; 
        }
        .size-btn { 
            padding: 12px 0; 
            border: 1px solid #e0e0e0; 
            background: #fff; 
            font-size: 12px; 
            font-weight: 700; 
            flex: 1; 
            min-width: 70px; 
            text-align: center;
        }
        .size-btn.active { 
            border-color: var(--dark); 
            background: var(--dark); 
            color: #fff; 
        }

        /* –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é */
        .bottom-nav { 
            position: fixed; 
            bottom: 0; 
            left: 0; 
            right: 0; 
            background: #fff; 
            display: flex; 
            justify-content: space-around; 
            padding: 12px 0 30px; 
            border-top: 1px solid var(--border); 
            z-index: 1500; 
        }
        .nav-item { 
            border: none; 
            background: none; 
            color: #b0b0b0; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            font-size: 9px; 
            font-weight: 700; 
            gap: 5px; 
            text-transform: uppercase;
            flex: 1;
        }
        .nav-item.active { color: var(--dark); }
        .nav-item svg { width: 22px; height: 22px; }

        /* –ö–∞—Ä—Ç–∞ */
        #map { 
            width: 100%; 
            height: 350px; 
            background: var(--light); 
            margin: 15px 0; 
            border: 1px solid var(--border); 
            position: relative;
        }
        
        /* –ê–¥–º–∏–Ω-–∑–æ–Ω–∞ */
        .admin-form { 
            background: var(--light); 
            padding: 20px; 
            border-radius: 5px; 
            margin-bottom: 30px; 
        }
        .form-group { margin-bottom: 15px; }
        .form-group label { 
            display: block; 
            font-size: 10px; 
            font-weight: 800; 
            margin-bottom: 5px; 
            text-transform: uppercase; 
        }
        .form-control { 
            width: 100%; 
            padding: 14px; 
            border: 1px solid #ddd; 
            font-family: inherit; 
            font-size: 14px; 
            border-radius: 0;
        }

        /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
        .info-content { padding: 25px; line-height: 1.7; font-size: 14px; }
        .info-content h2 { font-weight: 800; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 20px; }
        .back-btn { 
            display: inline-flex; 
            align-items: center; 
            gap: 10px; 
            font-weight: 700; 
            margin-bottom: 25px; 
            background: none; 
            border: 1px solid #000; 
            padding: 8px 15px; 
            font-size: 11px;
            text-transform: uppercase;
        }

        [v-cloak] { display: none; }
    </style>
</head>
<body>

<div id="app" v-cloak>
    
    <header class="header">
        <button @click="burgerOpen = true; vib()" style="border:none; background:none; padding: 5px;">
            <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
        </button>
        <h1 class="brand-name" @click="tab = 'catalog'">NARAN</h1>
        <div style="width: 34px;"></div>
    </header>

    <div v-if="burgerOpen" class="modal">
        <button class="close-modal" @click="burgerOpen = false">‚úï</button>
        <div class="info-content">
            <div v-if="!activeInfoPage">
                <h2 class="brand-name" style="font-size: 24px; margin-bottom: 40px;">–ú–µ–Ω—é</h2>
                <div style="display: flex; flex-direction: column; gap: 35px; font-weight: 700; text-transform: uppercase; letter-spacing: 2px;">
                    <div @click="activeInfoPage = 'about'; vib()">–û –Ω–∞—Å</div>
                    <div @click="activeInfoPage = 'delivery'; vib()">–î–æ—Å—Ç–∞–≤–∫–∞</div>
                    <div @click="activeInfoPage = 'return'; vib()">–í–æ–∑–≤—Ä–∞—Ç</div>
                    <div @click="contactSupport">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</div>
                </div>
            </div>
            <div v-else>
                <button class="back-btn" @click="activeInfoPage = null">‚Üê –ù–∞–∑–∞–¥</button>
                <div v-if="activeInfoPage === 'about'">
                    <h2>–û –±—Ä–µ–Ω–¥–µ</h2>
                    <p>NARAN PREMIUM ‚Äî —ç—Ç–æ –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω—ã–π –±—Ä–µ–Ω–¥ –æ–¥–µ–∂–¥—ã, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø–∞—Ö —ç—Å—Ç–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–∏–Ω–∏–º–∞–ª–∏–∑–º–∞ –∏ –±–µ—Å–∫–æ–º–ø—Ä–æ–º–∏—Å—Å–Ω–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤.</p>
                    <p>–ú—ã –≤–µ—Ä–∏–º, —á—Ç–æ –æ–¥–µ–∂–¥–∞ ‚Äî —ç—Ç–æ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –ª–∏—á–Ω–æ—Å—Ç–∏, –ø–æ—ç—Ç–æ–º—É –∫–∞–∂–¥–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è —Å–æ–∑–¥–∞–µ—Ç—Å—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º —Ç–∏—Ä–∞–∂–æ–º —Å –≤–Ω–∏–º–∞–Ω–∏–µ–º –∫ –º–µ–ª—å—á–∞–π—à–∏–º –¥–µ—Ç–∞–ª—è–º –∫—Ä–æ—è.</p>
                </div>
                <div v-if="activeInfoPage === 'delivery'">
                    <h2>–î–æ—Å—Ç–∞–≤–∫–∞</h2>
                    <p>–ú—ã –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ–º –¥–æ—Å—Ç–∞–≤–∫—É –ø–æ –≤—Å–µ–π —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ –†–§ –∏ —Å—Ç—Ä–∞–Ω–∞–º –°–ù–ì.</p>
                    <p>–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã:<br>
                    ‚Äî –°–î–≠–ö (–ü—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏ –∏–ª–∏ –ö—É—Ä—å–µ—Ä)<br>
                    ‚Äî –ü–æ—á—Ç–∞ –†–æ—Å—Å–∏–∏ (1 –∫–ª–∞—Å—Å)<br>
                    ‚Äî 5Post (–ü—É–Ω–∫—Ç—ã –≤—ã–¥–∞—á–∏ –≤ –º–∞–≥–∞–∑–∏–Ω–∞—Ö ¬´–ü—è—Ç–µ—Ä–æ—á–∫–∞¬ª)</p>
                    <p>–°—Ä–æ–∫ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞: 1-3 —Ä–∞–±–æ—á–∏—Ö –¥–Ω—è.</p>
                </div>
                <div v-if="activeInfoPage === 'return'">
                    <h2>–í–æ–∑–≤—Ä–∞—Ç</h2>
                    <p>–í—ã –∏–º–µ–µ—Ç–µ –ø—Ä–∞–≤–æ –≤–µ—Ä–Ω—É—Ç—å —Ç–æ–≤–∞—Ä –Ω–∞–¥–ª–µ–∂–∞—â–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ 14 –¥–Ω–µ–π —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∏—è, –µ—Å–ª–∏ –≤–µ—â—å –Ω–µ –±—ã–ª–∞ –≤ —É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤—Å–µ –±–∏—Ä–∫–∏.</p>
                </div>
            </div>
        </div>
    </div>

    <main class="container">
        
        <div v-if="tab === 'catalog'">
            <div class="cat-row">
                <button @click="setCat('')" :class="['cat-tab', currentCat === '' ? 'active' : '']">–í—Å–µ —Ç–æ–≤–∞—Ä—ã</button>
                <button v-for="c in staticCategories" :key="c" @click="setCat(c)" :class="['cat-tab', currentCat === c ? 'active' : '']">{{c}}</button>
            </div>

            <div v-if="loading" style="text-align: center; padding: 50px;">
                <div class="spinner"></div>
            </div>

            <div v-else class="products-grid">
                <div v-for="p in filteredItems" :key="p.id" class="card" @click="viewProduct(p)">
                    <div class="slider-wrapper">
                        <div class="slider-inner" @scroll="e => updateSliderIdx(e, p)">
                            <img v-for="img in p.images" :key="img" :src="img" loading="lazy">
                        </div>
                        <div class="dots" v-if="p.images.length > 1">
                            <span v-for="(img, i) in p.images" :key="i" :class="['dot', {active: i === (p.aIdx || 0)}]"></span>
                        </div>
                    </div>
                    <div class="card-info">
                        <div class="card-title">{{p.title}}</div>
                        <div class="price">{{p.price.toLocaleString()}} ‚ÇΩ</div>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="tab === 'favs'">
            <h2 class="brand-name" style="font-size: 16px; margin-bottom: 25px;">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</h2>
            <div v-if="favs.length === 0" style="text-align:center; padding: 100px 20px; color: #999; font-size: 12px; text-transform: uppercase; letter-spacing: 1px;">
                –í–∞—à —Å–ø–∏—Å–æ–∫ –∂–µ–ª–∞–Ω–∏–π –ø—É—Å—Ç
            </div>
            <div class="products-grid">
                <div v-for="p in favs" :key="p.favId" class="card" @click="viewProduct(p)">
                    <div class="slider-wrapper">
                        <div class="slider-inner" @scroll="e => updateSliderIdx(e, p)">
                            <img v-for="img in p.images" :key="img" :src="img">
                        </div>
                        <div class="dots" v-if="p.images.length > 1">
                            <span v-for="(img, i) in p.images" :key="i" :class="['dot', {active: i === (p.aIdx || 0)}]"></span>
                        </div>
                    </div>
                    <div class="card-info">
                        <div class="card-title">{{p.title}}</div>
                        <div style="font-size: 9px; color: #888; margin-bottom: 5px;">–†–ê–ó–ú–ï–†: {{p.selSize}}</div>
                        <div class="price">{{p.price.toLocaleString()}} ‚ÇΩ</div>
                        <button class="btn-black" @click.stop="removeFromFavs(p.favId)" style="margin-top:12px; padding: 10px; font-size: 9px; letter-spacing: 1px;">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="tab === 'cart'">
            <h2 class="brand-name" style="font-size: 16px; margin-bottom: 25px;">–ö–æ—Ä–∑–∏–Ω–∞</h2>
            <div v-if="cart.length === 0" style="text-align:center; padding: 100px 20px; color: #999; font-size: 12px; text-transform: uppercase;">
                –í –∫–æ—Ä–∑–∏–Ω–µ –ø–æ–∫–∞ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤
            </div>
            <div v-else>
                <div v-for="item in cart" :key="item.cartId" style="display:flex; gap:20px; margin-bottom: 25px; border-bottom: 1px solid var(--border); padding-bottom: 20px;">
                    <img :src="item.images[0]" style="width:90px; height:120px; object-fit:cover;">
                    <div style="flex:1; display: flex; flex-direction: column; justify-content: center;">
                        <div style="font-weight:700; font-size:12px; text-transform: uppercase; letter-spacing: 0.5px;">{{item.title}}</div>
                        <div style="font-size:10px; color:gray; margin: 8px 0;">–†–∞–∑–º–µ—Ä: {{item.selSize}}</div>
                        <div style="font-weight:800; font-size: 16px;">{{item.price.toLocaleString()}} ‚ÇΩ</div>
                    </div>
                    <button @click="removeFromCart(item.cartId)" style="border:none; background:none; padding: 10px; font-size: 18px;">‚úï</button>
                </div>

                <div style="margin-top: 40px; border-top: 2px solid #000; padding-top: 30px;">
                    <div class="form-group">
                        <label>–í–∞—à –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω</label>
                        <input v-model="orderForm.phone" type="tel" class="form-control" placeholder="+7 (___) ___-__-__">
                    </div>
                    
                    <div class="form-group">
                        <label>–°–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏</label>
                        <div style="display:flex; gap:8px;">
                            <button v-for="m in ['–°–î–≠–ö', '–ü–û–ß–¢–ê', '5POST']" :key="m" @click="delivMethod = m; initMapInstance()" :class="['cat-tab', {active: delivMethod === m}]" style="flex:1;">{{m}}</button>
                        </div>
                    </div>

                    <div v-show="delivMethod">
                        <label style="font-size: 10px; font-weight: 800; text-transform: uppercase;">–í—ã–±–µ—Ä–∏—Ç–µ –∞–¥—Ä–µ—Å –Ω–∞ –∫–∞—Ä—Ç–µ (–∫–ª–∏–∫ –ø–æ –∑–¥–∞–Ω–∏—é)</label>
                        <div id="map"></div>
                        <div v-if="selectedAddress" style="padding: 15px; background: #000; color: #fff; font-size: 11px; font-weight: 600; margin-bottom: 20px;">
                            üìç {{selectedAddress}}
                        </div>
                    </div>

                    <button class="btn-black" @click="submitOrder" :disabled="!selectedAddress || !orderForm.phone" style="height: 60px; font-size: 14px;">
                        –û—Ñ–æ—Ä–º–∏—Ç—å ‚Ä¢ {{cartTotal.toLocaleString()}} ‚ÇΩ
                    </button>
                </div>
            </div>
        </div>

        <div v-if="tab === 'profile'">
            <div v-if="isAdmin">
                <h2 class="brand-name" style="font-size: 18px; margin-bottom: 20px;">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2>
                
                <div class="admin-form">
                    <h3 style="font-size: 12px; font-weight: 800; margin-bottom: 20px; border-bottom: 1px solid #000; padding-bottom: 5px;">–ù–û–í–´–ô –¢–û–í–ê–†</h3>
                    
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                        <input v-model="newProduct.title" class="form-control" placeholder="–ù–∞–ø—Ä: –®–µ—Ä—Å—Ç—è–Ω–æ–π –ø–∏–¥–∂–∞–∫">
                    </div>
                    
                    <div class="form-group">
                        <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea v-model="newProduct.desc" class="form-control" style="height:100px;" placeholder="–°–æ—Å—Ç–∞–≤, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥–µ–ª–∏..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>–¶–µ–Ω–∞</label>
                        <input v-model.number="newProduct.price" type="number" class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                        <select v-model="newProduct.category" class="form-control">
                            <option v-for="c in staticCategories" :value="c">{{c}}</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ (–º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ)</label>
                        <input type="file" multiple @change="handleFileUpload" style="margin-top: 5px;">
                        <div v-if="uploading" style="font-size: 10px; color: blue; margin-top: 10px; font-weight: 700;">–ó–ê–ì–†–£–ó–ö–ê –§–ê–ô–õ–û–í...</div>
                    </div>

                    <div v-if="newProduct.images.length" style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom: 20px;">
                        <div v-for="(img, idx) in newProduct.images" :key="idx" style="position:relative;">
                            <img :src="img" style="width:60px; height:60px; object-fit:cover;">
                            <button @click="newProduct.images.splice(idx,1)" style="position:absolute; top:-5px; right:-5px; background:red; color:#fff; border:none; border-radius:50%; width:18px; height:18px; font-size:10px;">‚úï</button>
                        </div>
                    </div>

                    <button class="btn-black" @click="saveProductToDb" :disabled="uploading || !newProduct.title">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
                </div>

                <h3 class="brand-name" style="font-size: 14px; margin: 40px 0 20px;">–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ ({{items.length}})</h3>
                <div v-for="p in items" :key="p.id" style="display:flex; align-items:center; gap:15px; padding: 15px 0; border-bottom: 1px solid #eee;">
                    <img :src="p.images[0]" style="width:50px; height:50px; object-fit:cover;">
                    <div style="flex:1;">
                        <div style="font-size: 11px; font-weight: 700;">{{p.title}}</div>
                        <div style="font-size: 10px; color: #888;">{{p.price}} ‚ÇΩ | {{p.category}}</div>
                    </div>
                    <button @click="deleteItem(p.id)" style="color:red; border:none; background:none; font-weight: 800; font-size: 10px;">–£–î–ê–õ–ò–¢–¨</button>
                </div>
            </div>
            
            <div v-else style="text-align:center; padding: 60px 20px;">
                <div style="width: 100px; height: 100px; background: #f0f0f0; border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; font-size: 40px;">
                    {{user.first_name ? user.first_name[0] : 'U'}}
                </div>
                <h2 style="margin-bottom: 5px;">{{user.first_name}} {{user.last_name}}</h2>
                <p style="color: gray; font-size: 12px; margin-bottom: 40px;">ID: {{user.id}}</p>
                
                <button class="btn-black" @click="contactSupport">–°–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π</button>
                <p style="font-size: 9px; color: #ccc; margin-top: 50px; letter-spacing: 1px;">NARAN PREMIUM v4.5.0 PRO</p>
            </div>
        </div>
    </main>

    <div v-if="activeProduct" class="modal">
        <button class="close-modal" @click="activeProduct = null">‚úï</button>
        
        <div class="slider-wrapper" style="aspect-ratio: 1/1.3;">
            <div class="slider-inner" @scroll="e => updateSliderIdx(e, activeProduct)">
                <img v-for="img in activeProduct.images" :key="img" :src="img">
            </div>
            <div class="dots" v-if="activeProduct.images.length > 1">
                <span v-for="(img, i) in activeProduct.images" :key="i" :class="['dot', {active: i === (activeProduct.aIdx || 0)}]"></span>
            </div>
        </div>

        <div style="padding: 30px;">
            <div style="display:flex; justify-content:space-between; align-items: flex-start; margin-bottom: 10px;">
                <h2 class="brand-name" style="font-size:22px; margin:0;">{{activeProduct.title}}</h2>
                <div class="price" style="font-size:22px;">{{activeProduct.price.toLocaleString()}} ‚ÇΩ</div>
            </div>
            <div style="font-size: 11px; color: #999; text-transform: uppercase; letter-spacing: 1px;">–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {{activeProduct.category}}</div>
            
            <p style="font-size:14px; margin:30px 0; line-height:1.7; color: #444;">{{activeProduct.desc}}</p>
            
            <div style="font-weight:800; font-size:11px; margin-bottom:15px; text-transform: uppercase;">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä:</div>
            <div class="size-grid">
                <button v-for="s in ['42', '44', '46', '48']" :key="s" @click="activeProduct.selSize = s; vib()" :class="['size-btn', {active: activeProduct.selSize === s}]">{{s}}</button>
            </div>

            <div style="display:flex; gap:15px; margin-top:40px;">
                <button class="btn-black" @click="toggleFav(activeProduct)" style="background:#fff; color:#000; border:1px solid #000; flex:1;">
                    {{ isInFavs(activeProduct) ? '‚ù§ –í –ò–ó–ë–†–ê–ù–ù–û–ú' : '‚ô° –ò–ó–ë–†–ê–ù–ù–û–ï' }}
                </button>
                <button class="btn-black" @click="addToCart(activeProduct)" style="flex:1.5;">–í –∫–æ—Ä–∑–∏–Ω—É</button>
            </div>
        </div>
    </div>

    <nav class="bottom-nav">
        <button v-for="n in navigation" :key="n.id" @click="tab = n.id; vib()" :class="['nav-item', {active: tab === n.id}]">
            <svg v-html="n.icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg>
            <span>{{n.label}}</span>
        </button>
    </nav>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";
    
    const firebaseConfig = { 
        apiKey: "AIzaSyC6fihIMtOYZuPh-db3Tc6eiRgSikzydVw", 
        authDomain: "naran-80077.firebaseapp.com", 
        projectId: "naran-80077", 
        storageBucket: "naran-80077.firebasestorage.app", 
        messagingSenderId: "901156477154", 
        appId: "IG-PR8PLCMF3C" 
    };
    
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    window.fb = { collection, addDoc, onSnapshot, query, orderBy, doc, deleteDoc, db };
</script>

<script>
const tg = window.Telegram.WebApp;

Vue.createApp({
    data() {
        return {
            tab: 'catalog',
            burgerOpen: false,
            activeInfoPage: null,
            currentCat: '',
            loading: true,
            uploading: false,
            // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
            staticCategories: ['–ø–∏–¥–∂–∞–∫–∏', '—Å–≤–∏—Ç–µ—Ä—ã', '–∫–∞—Ä–¥–∏–≥–∞–Ω—ã', '–∫–æ—Å—Ç—é–º—ã', '–ª–æ–Ω–≥—Å–ª–∏–≤—ã', '—Ñ—É—Ç–±–æ–ª–∫–∏', '–∫–æ—Ä—Å–µ—Ç—ã', '–∫—É—Ä—Ç–∫–∏', '—ç–∫–æ—à—É–±—ã'],
            items: [],
            cart: JSON.parse(localStorage.getItem('naran_cart_v10') || '[]'),
            favs: JSON.parse(localStorage.getItem('naran_favs_v10') || '[]'),
            user: {},
            isAdmin: false,
            adminId: 387881523,
            activeProduct: null,
            delivMethod: '',
            selectedAddress: '',
            mapInstance: null,
            orderForm: { phone: '' },
            newProduct: { title: '', desc: '', price: 0, category: '–ø–∏–¥–∂–∞–∫–∏', images: [] },
            navigation: [
                { id: 'catalog', label: '–ö–∞—Ç–∞–ª–æ–≥', icon: '<rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect>' },
                { id: 'favs', label: '–ò–∑–±—Ä–∞–Ω–Ω–æ–µ', icon: '<path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>' },
                { id: 'cart', label: '–ö–æ—Ä–∑–∏–Ω–∞', icon: '<circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>' },
                { id: 'profile', label: '–ü—Ä–æ—Ñ–∏–ª—å', icon: '<path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle>' }
            ]
        }
    },
    computed: {
        filteredItems() {
            if (!this.currentCat) return this.items;
            return this.items.filter(i => i.category === this.currentCat);
        },
        cartTotal() {
            return this.cart.reduce((acc, val) => acc + Number(val.price), 0);
        }
    },
    methods: {
        vib() { tg.HapticFeedback.impactOccurred('medium'); },
        setCat(c) { this.vib(); this.currentCat = c; },
        updateSliderIdx(e, p) {
            p.aIdx = Math.round(e.target.scrollLeft / e.target.offsetWidth);
        },
        viewProduct(p) {
            this.vib();
            // –ö–ª–æ–Ω–∏—Ä—É–µ–º –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
            this.activeProduct = { ...p, aIdx: 0, selSize: p.selSize || '42' };
        },
        isInFavs(p) {
            return this.favs.some(f => f.id === p.id);
        },
        toggleFav(p) {
            this.vib();
            const idx = this.favs.findIndex(f => f.id === p.id);
            if (idx > -1) {
                this.favs.splice(idx, 1);
            } else {
                // –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ —Ñ–∏–∫—Å–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä
                this.favs.push({ ...p, favId: Date.now() });
            }
            this.saveStorage();
        },
        addToCart(p) {
            this.vib();
            this.cart.push({ ...p, cartId: Date.now() });
            this.saveStorage();
            this.activeProduct = null;
            tg.HapticFeedback.notificationOccurred('success');
        },
        removeFromCart(id) {
            this.cart = this.cart.filter(c => c.cartId !== id);
            this.saveStorage();
        },
        removeFromFavs(id) {
            this.favs = this.favs.filter(f => f.favId !== id);
            this.saveStorage();
        },
        saveStorage() {
            localStorage.setItem('naran_cart_v10', JSON.stringify(this.cart));
            localStorage.setItem('naran_favs_v10', JSON.stringify(this.favs));
        },
        
        // –†–ê–ë–û–¢–ê –° –ö–ê–†–¢–û–ô 2GIS (–ò–°–ü–†–ê–í–õ–ï–ù–û –î–õ–Ø –ó–î–ê–ù–ò–ô)
        initMapInstance() {
            this.vib();
            this.$nextTick(() => {
                const mapEl = document.getElementById('map');
                if (!mapEl) return;
                
                if (this.mapInstance) { this.mapInstance.destroy(); }

                this.mapInstance = new mapgl.Map('map', {
                    center: [37.6175, 55.7558],
                    zoom: 13,
                    key: 'cab82c94-e619-42eb-9814-3361712feaf0'
                });

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞ –∑–¥–∞–Ω–∏—è
                this.mapInstance.on('click', (e) => {
                    const [lng, lat] = e.lngLat;
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º API 2GIS –¥–ª—è –≥–µ–æ–∫–æ–¥–∏–Ω–≥–∞ –∫–ª–∏–∫–Ω—É—Ç–æ–π —Ç–æ—á–∫–∏
                    fetch(`https://catalog.api.2gis.com/3.0/items/geocode?lat=${lat}&lon=${lng}&fields=items.address&key=cab82c94-e619-42eb-9814-3361712feaf0`)
                    .then(res => res.json())
                    .then(data => {
                        if (data.result && data.result.items.length > 0) {
                            const addressObj = data.result.items[0];
                            this.selectedAddress = addressObj.full_name || addressObj.address_name || addressObj.name;
                            this.vib();
                        }
                    })
                    .catch(err => console.error("Map Error:", err));
                });
            });
        },

        // –ê–î–ú–ò–ù–ö–ê: –ó–ê–ì–†–£–ó–ö–ê –§–û–¢–û (IMGBB)
        async handleFileUpload(e) {
            this.uploading = true;
            const files = e.target.files;
            for (let f of files) {
                const fd = new FormData();
                fd.append('image', f);
                try {
                    const res = await fetch('https://api.imgbb.com/1/upload?key=839e62907e9a52f0159461b7771bcb2f', {
                        method: 'POST',
                        body: fd
                    });
                    const resData = await res.json();
                    if (resData.data && resData.data.url) {
                        this.newProduct.images.push(resData.data.url);
                    }
                } catch (err) {
                    console.error("Upload Fail:", err);
                }
            }
            this.uploading = false;
        },

        // –ê–î–ú–ò–ù–ö–ê: –°–û–•–†–ê–ù–ï–ù–ò–ï –í FIREBASE
        async saveProductToDb() {
            if (!this.newProduct.title || this.newProduct.images.length === 0) {
                alert("–£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ö–æ—Ç—è –±—ã 1 —Ñ–æ—Ç–æ");
                return;
            }
            this.uploading = true;
            try {
                await window.fb.addDoc(window.fb.collection(window.fb.db, "products"), {
                    ...this.newProduct,
                    price: Number(this.newProduct.price),
                    createdAt: Date.now()
                });
                this.newProduct = { title: '', desc: '', price: 0, category: '–ø–∏–¥–∂–∞–∫–∏', images: [] };
                alert("–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–∞—Ç–∞–ª–æ–≥!");
            } catch (err) {
                alert("–û—à–∏–±–∫–∞ –ë–î");
            }
            this.uploading = false;
        },

        async deleteItem(id) {
            if (confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä –∏–∑ –±–∞–∑—ã?")) {
                await window.fb.deleteDoc(window.fb.doc(window.fb.db, "products", id));
            }
        },

        // –ó–ê–ö–ê–ó –í –¢–ï–õ–ï–ì–†–ê–ú
        submitOrder() {
            if (!this.orderForm.phone || !this.selectedAddress) return;
            this.vib();
            
            const summary = {
                phone: this.orderForm.phone,
                address: this.selectedAddress,
                method: this.delivMethod,
                total: this.cartTotal,
                items: this.cart.map(i => `${i.title} (${i.selSize}) - ${i.price}—Ä`)
            };
            
            const message = `üõç –ù–û–í–´–ô –ó–ê–ö–ê–ó\n\n` +
                            `üìû –¢–µ–ª: ${summary.phone}\n` +
                            `üìç –ê–¥—Ä–µ—Å: ${summary.address}\n` +
                            `üöö –ú–µ—Ç–æ–¥: ${summary.method}\n` +
                            `üí∞ –ò—Ç–æ–≥–æ: ${summary.total.toLocaleString()} ‚ÇΩ\n\n` +
                            `üì¶ –°–æ—Å—Ç–∞–≤:\n${summary.items.join('\n')}`;
            
            tg.sendData(message);
            this.cart = [];
            this.saveStorage();
            tg.close();
        },
