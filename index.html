<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NARAN</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://mapgl.2gis.com/api/js/v1"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root { 
            --accent: #e0dbda; 
            --bg: #ffffff; 
            --card-bg: #ffffff;
            --dark: #2d2d2d; 
            --gray: #775d5d; 
            --red: #523434; 
            --light-pink: rgba(255, 133, 162, 0.1); 
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body { 
            margin: 0; 
            background: var(--bg); 
            font-family: 'Montserrat', sans-serif; 
            color: var(--dark); 
            overflow-x: hidden; 
        }
        
        .header { 
            background: #fff; 
            padding: 20px 15px; 
            text-align: center; 
            border-bottom: 2px solid var(--light-pink); 
            position: sticky; 
            top: 0; 
            z-index: 100; 
        }

        .brand-name { 
            font-size: 22px; 
            margin: 0; 
            font-weight: 800; 
            letter-spacing: -0.5px; 
        }

        .container { padding: 15px; padding-bottom: 110px; }

        .cat-row { display: flex; gap: 8px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; }
        .cat-tab { 
            padding: 10px 20px; 
            border-radius: 25px; 
            border: 1.5px solid var(--accent); 
            background: #fff; 
            color: var(--accent); 
            font-size: 11px; 
            font-weight: 800; 
            white-space: nowrap; 
            text-transform: uppercase; 
        }
        .cat-tab.active { background: var(--accent); color: #fff; }

        .products-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .card { 
            background: var(--card-bg); 
            border-radius: 20px; 
            overflow: hidden; 
            border: 1px solid rgba(255, 133, 162, 0.2); 
            position: relative; 
            display: flex; 
            flex-direction: column; 
            box-shadow: 0 4px 15px rgba(255, 133, 162, 0.1); 
        }
        
        .slider-wrapper { position: relative; width: 100%; aspect-ratio: 3/4; overflow: hidden; background: #fdfdfd; }
        .slider-inner { display: flex; overflow-x: auto; scroll-snap-type: x mandatory; scrollbar-width: none; height: 100%; }
        .slider-inner img { width: 100%; height: 100%; object-fit: cover; scroll-snap-align: start; flex-shrink: 0; }

        .dots { position: absolute; bottom: 8px; width: 100%; text-align: center; pointer-events: none; }
        .dot { display: inline-block; width: 6px; height: 6px; border-radius: 50%; margin: 0 3px; background: rgba(0,0,0,0.1); }
        .dot.active { background: var(--accent); }

        .fav-heart { 
            position: absolute; top: 10px; right: 10px; z-index: 10; 
            background: rgba(255, 255, 255, 0.6); backdrop-filter: blur(8px); 
            border-radius: 50%; width: 34px; height: 34px; 
            display: flex; align-items: center; justify-content: center; border: none; 
        }
        .fav-heart svg { width: 18px; height: 18px; fill: none; stroke: var(--accent); stroke-width: 2.5px; }
        .fav-heart.active svg { fill: var(--red); stroke: var(--red); }

        .card-info { padding: 12px; text-align: center; }
        .card-title { font-size: 12px; font-weight: 700; margin-bottom: 6px; height: 30px; overflow: hidden; }
        .card-price { color: var(--accent); font-weight: 800; font-size: 16px; margin-bottom: 10px; }
        
        .size-btns { display: flex; justify-content: center; gap: 4px; margin-bottom: 12px; flex-wrap: wrap; }
        .s-btn { padding: 6px 10px; border: 1px solid #eee; border-radius: 8px; font-size: 10px; font-weight: 800; background: #fff; }
        .s-btn.active { border-color: var(--accent); background: var(--light-pink); color: var(--accent); }

        .buy-btn { width: 100%; padding: 12px; background: var(--accent); color: #fff; border: none; border-radius: 12px; font-size: 10px; font-weight: 800; text-transform: uppercase; }

        .bottom-nav { 
            position: fixed; bottom: 0; left: 0; right: 0; 
            background: #fff; display: flex; justify-content: space-around; 
            padding: 10px 0 25px 0; border-top: 1px solid var(--light-pink); z-index: 999; 
        }
        .nav-item { 
            border: none; background: none; color: var(--gray); 
            display: flex; flex-direction: column; align-items: center; 
            font-size: 9px; gap: 4px; width: 25%; font-weight: 600; 
        }
        .nav-item.active { color: var(--accent); }
        .nav-item svg { width: 24px; height: 24px; fill: currentColor; }

        .modal { position: fixed; inset: 0; background: #fff; z-index: 2000; overflow-y: auto; padding-bottom: 40px; }
        .close-m { 
            position: fixed; top: 15px; left: 15px; width: 40px; height: 40px; 
            border-radius: 50%; background: #fff; border: 1px solid #eee; 
            z-index: 2100; display: flex; align-items: center; justify-content: center; font-size: 20px; 
        }

        #map { width: 100%; height: 300px; border-radius: 20px; margin-top: 15px; border: 1px solid var(--accent); }

        .input-c { width: 100%; padding: 14px; border-radius: 12px; border: 1px solid #eee; font-size: 15px; background: #fdfdfd; margin-bottom: 10px; font-family: inherit; }
        .order-btn { width: 100%; padding: 18px; background: var(--accent); color: #fff; border: none; border-radius: 18px; font-weight: 800; font-size: 16px; margin-top: 20px; }

        .side-menu { position: fixed; top: 0; left: 0; bottom: 0; width: 280px; background: #fff; z-index: 3001; padding: 25px; transition: 0.3s transform; box-shadow: 5px 0 15px rgba(0,0,0,0.1); }
        .menu-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 3000; }
    </style>
</head>
<body>

<div id="app">
    <div v-if="showMenu" class="menu-overlay" @click="showMenu = false"></div>
    <div class="side-menu" :style="{ transform: showMenu ? 'translateX(0)' : 'translateX(-100%)' }">
        <button @click="showMenu = false" style="float:right; border:none; background:none; font-size:24px;">‚úï</button>
        <h2 class="brand-name" style="margin-bottom:30px;">NARAN</h2>
        <div style="display: flex; flex-direction: column; gap: 20px;">
            <button @click="activeInfo = 'about'; showMenu = false" style="text-align:left; border:none; background:none; font-size:16px; font-weight:700;">–û –Ω–∞—Å</button>
            <button @click="openDelivery" style="text-align:left; border:none; background:none; font-size:16px; font-weight:700;">–î–æ—Å—Ç–∞–≤–∫–∞</button>
            <button @click="activeInfo = 'returns'; showMenu = false" style="text-align:left; border:none; background:none; font-size:16px; font-weight:700;">–í–æ–∑–≤—Ä–∞—Ç</button>
        </div>
    </div>

    <div class="header">
        <div style="display: flex; align-items: center; justify-content: space-between;">
            <button @click="showMenu = true" style="border:none; background:none; padding:5px;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
            </button>
            <h1 class="brand-name">NARAN</h1>
            <div style="width:34px;"></div>
        </div>
    </div>

    <div class="container">
        <div v-if="activeTab === 'catalog'">
            <div class="cat-row">
                <button v-for="c in categories" :key="c" @click="currentCat = c" :class="['cat-tab', currentCat === c ? 'active' : '']">{{c}}</button>
                <button @click="currentCat = ''" :class="['cat-tab', currentCat === '' ? 'active' : '']">–í—Å–µ</button>
            </div>
            <div class="products-grid">
                <div v-for="p in filteredProducts" :key="p.id" class="card">
                    <button class="fav-heart" @click.stop="toggleFav(p)" :class="{active: isFav(p)}">
                        <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                    </button>
                    <div class="slider-wrapper" @click="selP = p">
                        <div class="slider-inner" @scroll="e => handleScroll(e, p)">
                            <img v-for="img in p.images" :key="img" :src="img">
                        </div>
                        <div class="dots">
                            <span v-for="(img, idx) in p.images" :key="idx" :class="['dot', idx === p.aIdx ? 'active' : '']"></span>
                        </div>
                    </div>
                    <div class="card-info">
                        <div class="card-title">{{p.title}}</div>
                        <div class="card-price">{{p.price}} ‚ÇΩ</div>
                        <div class="size-btns">
                            <button v-for="s in p.sizes" :key="s" @click.stop="p.selectedSize = s" :class="['s-btn', p.selectedSize === s ? 'active' : '']">{{s}}</button>
                        </div>
                        <button class="buy-btn" @click.stop="addToCart(p)">–í –∫–æ—Ä–∑–∏–Ω—É</button>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="activeTab === 'favs'">
            <h2 class="brand-name" style="margin-bottom:20px;">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</h2>
            <div v-if="favProducts.length === 0" style="text-align:center; padding:50px 0;">–ù–∏—á–µ–≥–æ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ ‚ù§Ô∏è</div>
            <div class="products-grid">
                <div v-for="p in favProducts" :key="p.id" class="card">
                    <div class="slider-wrapper" @click="selP = p">
                        <img :src="p.images[0]" style="width:100%; height:100%; object-fit:cover;">
                    </div>
                    <div class="card-info">
                        <div class="card-title">{{p.title}}</div>
                        <div class="card-price">{{p.price}} ‚ÇΩ</div>
                        <div style="font-size: 10px; margin-bottom: 5px;">–†–∞–∑–º–µ—Ä: {{p.selectedSize || '–ù–µ –≤—ã–±—Ä–∞–Ω'}}</div>
                        <button class="buy-btn" @click="selP = p">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å</button>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="activeTab === 'cart'">
            <h2 class="brand-name" style="margin-bottom:20px;">–ö–æ—Ä–∑–∏–Ω–∞</h2>
            <div v-if="cart.length === 0" style="text-align:center; padding:50px 0;">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>
            <div v-else>
                <div v-for="item in cart" :key="item.cartId" @click="selP = item" style="display:flex; gap:15px; padding:15px 0; border-bottom:1px solid #eee;">
                    <img :src="item.images[0]" style="width:70px; height:90px; object-fit:cover; border-radius:12px;">
                    <div style="flex:1;">
                        <div style="font-weight:700;">{{item.title}}</div>
                        <div style="font-size:12px; color:var(--gray);">–†–∞–∑–º–µ—Ä: {{item.selectedSize}}</div>
                        <div style="color:var(--accent); font-weight:800; margin-top:5px;">{{item.price}} ‚ÇΩ</div>
                    </div>
                    <button @click.stop="removeC(item.cartId)" style="border:none; background:none; font-size:20px;">‚úï</button>
                </div>
                <div style="margin-top:20px;">
                    <input class="input-c" v-model="form.name" placeholder="–í–∞—à–µ –∏–º—è">
                    <input class="input-c" v-model="form.phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" type="tel">
                    <input class="input-c" v-model="form.address" placeholder="–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏">
                </div>
                <button class="order-btn" @click="sendOrder">–ó–ê–ö–ê–ó–ê–¢–¨: {{total}} ‚ÇΩ</button>
            </div>
        </div>

        <div v-if="activeTab === 'profile'">
            <div style="text-align:center; padding:30px 0;">
                <div style="width:80px; height:80px; background:var(--accent); border-radius:50%; margin:0 auto 10px;"></div>
                <h2>{{user.first_name || '–ì–æ—Å—Ç—å'}}</h2>
            </div>
            
            <div v-if="isAdmin" style="border-top:2px solid var(--light-pink); padding-top:20px;">
                <h3 style="text-align:center;">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å: –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h3>
                <input class="input-c" v-model="newP.title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
                <input class="input-c" v-model.number="newP.price" placeholder="–¶–µ–Ω–∞">
                <select class="input-c" v-model="newP.category">
                    <option v-for="cat in categories" :key="cat" :value="cat">{{cat}}</option>
                </select>
                <input class="input-c" v-model="newP.sizesInput" placeholder="–†–∞–∑–º–µ—Ä—ã (42, 44, 46)">
                <textarea class="input-c" v-model="newP.desc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ"></textarea>
                <input type="file" @change="handleFileUpload" class="input-c">
                <button class="buy-btn" @click="addProduct" :disabled="uploading" style="padding:15px;">{{uploading ? '–ó–∞–≥—Ä—É–∑–∫–∞...' : '–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å'}}</button>
            </div>
        </div>
    </div>

    <div v-if="selP" class="modal">
        <button class="close-m" @click="selP = null">‚úï</button>
        <div class="slider-wrapper" style="aspect-ratio:1/1.2;">
            <div class="slider-inner" @scroll="e => handleScroll(e, selP)">
                <img v-for="img in selP.images" :key="img" :src="img">
            </div>
            <div class="dots">
                <span v-for="(img, idx) in selP.images" :key="idx" :class="['dot', idx === selP.aIdx ? 'active' : '']"></span>
            </div>
        </div>
        <div style="padding:20px;">
            <h2 class="brand-name">{{selP.title}}</h2>
            <div style="font-size:24px; color:var(--accent); font-weight:800;">{{selP.price}} ‚ÇΩ</div>
            <p style="color:#666; line-height:1.6; margin: 15px 0;">{{selP.desc || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è'}}</p>
            <div class="size-btns">
                <button v-for="s in selP.sizes" :key="s" @click="selP.selectedSize = s" :class="['s-btn', selP.selectedSize === s ? 'active' : '']" style="padding:15px; font-size:14px;">{{s}}</button>
            </div>
            <button class="order-btn" @click="addToCart(selP)">–í –∫–æ—Ä–∑–∏–Ω—É</button>
        </div>
    </div>

    <div v-if="activeInfo === 'delivery'" class="modal">
        <button class="close-m" @click="activeInfo = null">‚úï</button>
        <div style="padding:60px 20px;">
            <h2 class="brand-name">–î–æ—Å—Ç–∞–≤–∫–∞</h2>
            <p>–ù–∞—à –º–∞–≥–∞–∑–∏–Ω –Ω–∞ –∫–∞—Ä—Ç–µ. –í—ã–±–µ—Ä–∏—Ç–µ —É–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞.</p>
            <div id="map"></div>
            <p style="margin-top: 15px; font-size: 14px; color: #666;">üìç –≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, 10</p>
        </div>
    </div>

    <div v-if="activeInfo && activeInfo !== 'delivery'" class="modal">
        <button class="close-m" @click="activeInfo = null">‚úï</button>
        <div style="padding:60px 20px;">
            <h2 class="brand-name">{{ activeInfo === 'about' ? '–û –Ω–∞—Å' : '–í–æ–∑–≤—Ä–∞—Ç' }}</h2>
            <p v-if="activeInfo === 'about'">NARAN ‚Äî —ç—Ç–æ –ø—Ä–µ–º–∏–∞–ª—å–Ω—ã–π –±—Ä–µ–Ω–¥ –æ–¥–µ–∂–¥—ã –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ —Ü–µ–Ω–∏—Ç –∫–∞—á–µ—Å—Ç–≤–æ –∏ —Å—Ç–∏–ª—å.</p>
            <p v-if="activeInfo === 'returns'">–í–æ–∑–≤—Ä–∞—Ç —Ç–æ–≤–∞—Ä–∞ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 14 –¥–Ω–µ–π —Å–æ–≥–ª–∞—Å–Ω–æ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤—É.</p>
        </div>
    </div>

    <nav class="bottom-nav">
        <button @click="activeTab = 'catalog'" :class="['nav-item', activeTab === 'catalog' ? 'active' : '']">
            <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg><span>–ì–ª–∞–≤–Ω–∞—è</span>
        </button>
        <button @click="activeTab = 'favs'" :class="['nav-item', activeTab === 'favs' ? 'active' : '']">
            <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg><span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
        </button>
        <button @click="activeTab = 'cart'" :class="['nav-item', activeTab === 'cart' ? 'active' : '']">
            <svg viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg><span>–ö–æ—Ä–∑–∏–Ω–∞</span>
        </button>
        <button @click="activeTab = 'profile'" :class="['nav-item', activeTab === 'profile' ? 'active' : '']">
            <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg><span>–ü—Ä–æ—Ñ–∏–ª—å</span>
        </button>
    </nav>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyC6fihIMtOYZuPh-db3Tc6eiRgSikzydVw",
        authDomain: "naran-80077.firebaseapp.com",
        projectId: "naran-80077",
        storageBucket: "naran-80077.firebasestorage.app",
        messagingSenderId: "901156477154",
        appId: "IG-PR8PLCMF3C"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    window.db = db;
    window.fbMethods = { collection, addDoc, onSnapshot, doc, updateDoc, serverTimestamp };
</script>

<script>
    const tg = window.Telegram.WebApp;
    const { createApp, nextTick } = Vue;

    createApp({
        data() {
            return {
                adminId: 387881523,
                isAdmin: false,
                activeTab: 'catalog',
                activeInfo: null,
                showMenu: false,
                currentCat: '',
                categories: ['–ø–∏–¥–∂–∞–∫–∏', '—Å–≤–∏—Ç–µ—Ä—ã', '–∫–∞—Ä–¥–∏–≥–∞–Ω—ã', '–∫–æ—Å—Ç—é–º—ã', '–ª–æ–Ω–≥—Å–ª–∏–≤—ã', '—Ñ—É—Ç–±–æ–ª–∫–∏', '–∫–æ—Ä—Å–µ—Ç—ã', '–∫—É—Ä—Ç–∫–∏', '—ç–∫–æ—à—É–±—ã'],
                products: [],
                favorites: JSON.parse(localStorage.getItem('mimi_favs')) || [],
                cart: JSON.parse(localStorage.getItem('mimi_cart')) || [],
                user: {},
                selP: null,
                uploading: false,
                newP: { title: '', price: '', category: '–ø–∏–¥–∂–∞–∫–∏', sizesInput: '42, 44', desc: '', img: '' },
                form: { name: '', phone: '', address: '' }
            }
        },
        computed: {
            filteredProducts() { return this.products.filter(p => !this.currentCat || p.category === this.currentCat); },
            favProducts() { return this.products.filter(p => this.favorites.includes(p.id)); },
            total() { return this.cart.reduce((s, i) => s + Number(i.price), 0); }
        },
        methods: {
            // –ú–ï–¢–û–î –î–õ–Ø –ö–ê–†–¢–´ 2–ì–ò–°
            async openDelivery() {
                this.activeInfo = 'delivery';
                this.showMenu = false;
                await nextTick();
                setTimeout(() => {
                    const map = new mapgl.Map('map', {
                        center: [37.6176, 55.7558],
                        zoom: 13,
                        key: 'a1234567-b89c-12d3-e456-f78901234567'
                    });
                    new mapgl.Marker(map, { coordinates: [37.6176, 55.7558] });
                }, 300);
            },
            handleScroll(e, p) { p.aIdx = Math.round(e.target.scrollLeft / e.target.offsetWidth); },
            toggleFav(p) {
                const i = this.favorites.indexOf(p.id);
                if (i > -1) this.favorites.splice(i, 1); else this.favorites.push(p.id);
                localStorage.setItem('mimi_favs', JSON.stringify(this.favorites));
                tg.HapticFeedback.impactOccurred('light');
            },
            isFav(p) { return this.favorites.includes(p.id); },
            addToCart(p) {
                if (!p.selectedSize) { tg.showAlert("–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä!"); return; }
                this.cart.push({ ...p, cartId: Date.now() });
                localStorage.setItem('mimi_cart', JSON.stringify(this.cart));
                tg.showAlert("–¢–æ–≤–∞—Ä —Å —Ä–∞–∑–º–µ—Ä–æ–º " + p.selectedSize + " –¥–æ–±–∞–≤–ª–µ–Ω!");
                this.selP = null;
            },
            removeC(id) {
                this.cart = this.cart.filter(i => i.cartId !== id);
                localStorage.setItem('mimi_cart', JSON.stringify(this.cart));
            },
            async handleFileUpload(e) {
                const file = e.target.files[0];
                this.uploading = true;
                const fd = new FormData(); fd.append('image', file);
                const res = await fetch('https://api.imgbb.com/1/upload?key=839e62907e9a52f0159461b7771bcb2f', { method: 'POST', body: fd });
                const d = await res.json();
                if (d.success) this.newP.img = d.data.display_url;
                this.uploading = false;
            },
            async addProduct() {
                const sizes = this.newP.sizesInput.split(',').map(s => s.trim());
                await window.fbMethods.addDoc(window.fbMethods.collection(window.db, "products"), {
                    ...this.newP, sizes: sizes, images: [this.newP.img], createdAt: window.fbMethods.serverTimestamp()
                });
                tg.showAlert("–¢–æ–≤–∞—Ä –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω!");
            },
            sendOrder() {
                const orderData = { user: this.form, cart: this.cart, total: this.total };
                tg.sendData(JSON.stringify(orderData));
            }
        },
        mounted() {
            tg.ready();
            tg.expand();
            const check = setInterval(() => {
                if (window.fbMethods) {
                    clearInterval(check);
                    window.fbMethods.onSnapshot(window.fbMethods.collection(window.db, "products"), snap => {
                        this.products = snap.docs.map(d => ({ id: d.id, ...d.data(), aIdx: 0, selectedSize: null }));
                    });
                }
            }, 100);
            if (tg.initDataUnsafe?.user) {
                this.user = tg.initDataUnsafe.user;
                if (Number(this.user.id) === Number(this.adminId)) this.isAdmin = true;
            }
        }
    }).mount('#app');
</script>
</body>
</html>
